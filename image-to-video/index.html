<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flux Kontext AI | Free AI Text-to-Image Editing with Character Consistency</title>
    <meta name="description" content="Flux Kontext AI is a revolutionary free AI text-to-image editing tool. Instantly make precise, consistent edits to your photos and digital art using natural language instructions. Enjoy character consistency, fast results, and professional-grade image enhancement. No watermark, no registration required. Try Flux Kontext for creative, accurate, and user-friendly AI image editing.">
    <meta name="keywords" content="photo hd converter, ai image upscaler, image quality enhancer, 4k image upscaler, image resolution enhancer, photo quality improver, ai photo enhancement, upscale image online, free image upscaler, batch image upscaler, image enlarger without quality loss, hd photo converter online, ai image enhancement tool, photo resolution increaser">
    <script src="../tailwind.js"></script>
    <link rel="stylesheet" href="../tailwind.css">
    <link rel="stylesheet" href="../css/home.css">
    <link rel="canonical" href="https://flux-kontext-ai.org"/>
    
    <script src="../js/custom-toast.js"></script>
    <script src="../js/my-common-util.js"></script>
    <script src="../js/my-dropdown-menu.js"></script>
    <script src="../js/my-loading-util.js"></script>
    <script src="../js/my-local-storage-util.js"></script>
    <script src="../js/my-login.js"></script>
    <script src="../js/my-footer.js"></script>
    
    <script src="../js/my-lan-config.js"></script>
    <script src="../js/my-lan-manager.js"></script>
</head>

<body class="bg-[#0f1115] text-gray-200">
    <!-- Top Navigation -->
    <header class="fixed top-0 inset-x-0 h-14 bg-[#0b0d12]/90 backdrop-blur border-b border-white/5 z-50">
        <div class="max-w-[1400px] mx-auto h-full px-4 flex items-center">
            <div class="flex items-center gap-2 text-xl font-semibold select-none">
                <span class="text-[#6aa7ff]">Seedance</span>
                <span class="text-white">AI</span>
            </div>
            <nav class="ml-6 hidden md:flex items-center gap-6 text-sm text-gray-300">
                <button id="id_btn_nav_video" class="group inline-flex items-center gap-1.5 hover:text-white cursor-pointer">
                    AI 视频
                    <svg class="w-3.5 h-3.5 text-gray-400 group-hover:text-white transition" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <button id="id_btn_nav_effects" class="group inline-flex items-center gap-1.5 hover:text-white cursor-pointer">
                    视频特效
                    <svg class="w-3.5 h-3.5 text-gray-400 group-hover:text-white transition" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <button id="id_btn_nav_image" class="group inline-flex items-center gap-1.5 hover:text-white cursor-pointer">
                    AI 图片
                    <svg class="w-3.5 h-3.5 text-gray-400 group-hover:text-white transition" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <button id="id_btn_nav_gallery" class="group inline-flex items-center gap-1.5 hover:text-white cursor-pointer">
                    画廊
                    <svg class="w-3.5 h-3.5 text-gray-400 group-hover:text-white transition" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg>
                </button>
                <button id="id_btn_nav_pricing" class="group inline-flex items-center gap-1.5 hover:text-white cursor-pointer">
                    价格
                    <svg class="w-3.5 h-3.5 text-gray-400 group-hover:text-white transition" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l6 6 6-6"/></svg>
                </button>
            </nav>
            <div class="ml-auto flex items-center gap-3">
                <!-- Language -->
                <button id="langBtn" class="px-3 h-8 rounded-md bg-white/5 hover:bg-white/10 text-sm flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-gray-300"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zm7.938 9H16.5a15.96 15.96 0 00-1.54-6.236A8.003 8.003 0 0119.938 11zM12 20a13.96 13.96 0 01-2.062-7H14.06A13.96 13.96 0 0112 20zM9.94 11a11.963 11.963 0 011.724-5.52c.11-.196.226-.39.344-.58.118.19.234.384.344.58A11.963 11.963 0 0114.06 11H9.94zM9.04 4.764A15.96 15.96 0 007.5 11H4.062A8.003 8.003 0 019.04 4.764zM4.062 13H7.5a15.96 15.96 0 001.54 6.236A8.003 8.003 0 014.062 13zM14.96 19.236A15.96 15.96 0 0016.5 13h3.438a8.003 8.003 0 01-4.978 6.236z"/></svg>
                    简体中文
                </button>
                <!-- Theme -->
                <button id="themeToggle" class="p-2 rounded-md bg-white/5 hover:bg-white/10" title="切换主题">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-gray-300">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0112 21.75 9.75 9.75 0 1112 2.25c.434 0 .862.028 1.283.083a.75.75 0 01.33 1.35 7.5 7.5 0 008.139 10.819.75.75 0 01.001 1.5z" />
                    </svg>
                </button>
                <!-- Avatar -->
                <button class="ml-1 w-8 h-8 rounded-full bg-gradient-to-r from-[#344151] to-[#1e2633] text-xs text-white flex items-center justify-center">不息</button>
            </div>
        </div>
    </header>

    <!-- Sidebar + Main -->
    <div class="pt-14 max-w-[1400px] mx-auto px-4">
        <div class="grid grid-cols-[260px,1fr] gap-4">
            <!-- Sidebar -->
            <aside class="h-[calc(100vh-64px)] sticky top-14 bg-[#0b0e13] border border-white/5 rounded-lg overflow-hidden">
                <div class="h-full overflow-y-auto pr-2 custom-scroll">
                    <div class="p-3">
                        <div class="text-xs text-gray-400 mb-2">AI Video</div>
                        <nav class="space-y-1">
                            <button class="sb-item">
                                <svg class="sb-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="6" width="18" height="12" rx="2"></rect><path d="M7 10h10M7 14h6"/></svg>
                                <span class="sb-text">Text to Video</span>
                            </button>
                            <button class="sb-item sb-active">
                                <svg class="sb-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="3" width="7" height="7" rx="1.5"></rect><rect x="14" y="3" width="7" height="7" rx="1.5"></rect><rect x="3" y="14" width="7" height="7" rx="1.5"></rect><rect x="14" y="14" width="7" height="7" rx="1.5"></rect></svg>
                                <span class="sb-text">Image to Video</span>
                            </button>
                        </nav>
                    </div>

                    <div class="px-3 mt-4">
                        <div class="text-xs text-gray-400 mb-2">AI Image</div>
                        <nav class="space-y-1">
                            <button class="sb-item"><svg class="sb-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M4 5h16M4 10h10M4 15h8"/></svg><span class="sb-text">
                                Text to Image</span></button>
                            <button class="sb-item"><svg class="sb-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="12" cy="12" r="9"/><path d="M9 12l2 2 4-4"/></svg><span class="sb-text">
                                Image to Image</span></button>
                        </nav>
                    </div>

                </div>
            </aside>

            <!-- Main -->
            <main class="min-h-[calc(100vh-64px)]">
                <div class="grid grid-cols-1 lg:grid-cols-[520px,1fr] gap-4">
                    <!-- Left form card -->
                    <section class="bg-[#0b0e13] border border-white/5 rounded-lg p-4">
                        <!-- 选择模型 -->
                        <div class="mt-4">
                            <label class="block text-sm text-gray-300 mb-1">选择模型</label>
                            <div class="relative mt-2 w-40">
                                <!-- 原生 select 保留但隐藏，用于同步值与可访问性 -->
                                <select id="id_select_model" class="hidden">
                                    <option value="480p" selected>Google VEO3</option>
                                    <option value="720p">RunWay Gen-4</option>
                                    <option value="1080p">Midjourney</option>
                                </select>
                                <!-- 触发按钮：宽度继承容器，右侧箭头 -->
                                <button id="id_btn_model" class="w-full appearance-none px-3 py-2 pr-7 rounded bg-white/5 border border-white/10 text-sm hover:bg-white/8 focus:outline-none focus:ring-2 focus:ring-blue-500/40 flex items-center justify-between">
                                    <span id="id_text_model">Google VEO3</span>
                                    <svg class="w-4 h-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>
                                </button>
                            </div>
                        </div>

                        <!-- Input method -->
                        <div class="mt-4">
                            <label class="block text-sm text-gray-300 mb-1">图像</label>
                        </div>
                        <!-- Upload area -->
                        <div id="uploadCard" class="mt-2 rounded-lg border border-white/10 bg-[#0f131a] h-48 flex flex-col items-center justify-center text-sm">
                            <div class="w-11 h-11 rounded-full bg-[#1b2330] flex items-center justify-center mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-gray-300">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 7.5L12 3m0 0L7.5 7.5M12 3v13.5" />
                                </svg>
                            </div>
                            <div class="text-gray-300">点击上传或拖拽到此处</div>
                            <div class="text-xs text-gray-500 mt-1">PNG, JPG, JPEG, GIF, WEBP</div>
                            <input id="fileInput" type="file" accept="image/*" class="hidden" />
                            <button id="chooseFile" class="mt-3 px-3 py-1.5 bg-white/5 hover:bg-white/10 rounded text-sm">选择图片</button>
                        </div>

                        <!-- Prompt -->
                        <div class="mt-4">
                            <label class="block text-sm text-gray-300 mb-1">提示词</label>
                            <textarea id="prompt" rows="10" class="w-full mt-2 px-2 py-2 rounded bg-white/5 border border-white/10 focus:outline-none focus:ring-2 focus:ring-blue-500/40 text-sm" placeholder="描述你的视频..."></textarea>
                        </div>

                        <!-- 分辨率-选择 -->
                        <div class="mt-4">
                            <label class="block text-sm text-gray-300 mb-1">分辨率</label>
                            <div class="relative w-40">
                                <!-- 原生 select 保留但隐藏，用于同步值与可访问性 -->
                                <select id="id_select_resolution" class="hidden">
                                    <option value="480p" selected>480p</option>
                                    <option value="720p">720p</option>
                                    <option value="1080p">1080p</option>
                                </select>
                                <!-- 触发按钮：宽度继承容器，右侧箭头 -->
                                <button id="id_btn_resolution" class="w-full appearance-none px-3 py-2 pr-7 rounded bg-white/5 border border-white/10 text-sm hover:bg-white/8 focus:outline-none focus:ring-2 focus:ring-blue-500/40 flex items-center justify-between">
                                    <span id="id_text_resolution">480p</span>
                                    <svg class="w-4 h-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" /></svg>
                                </button>
                            </div>
                        </div>

                        <!-- 宽高比选择（与图片一致的卡片式样式） -->
                        <div class="mt-6">
                            <div class="flex items-end justify-between">
                                <div>
                                    <h3 class="text-white text-base font-semibold">Aspect Ratio</h3>
                                    <p class="text-gray-400 text-xs mt-1">Choose the appropriate aspect ratio.</p>
                                </div>
                            </div>
                            <!-- 隐藏域：存储当前选中的宽高比值，默认 9:16 -->
                            <input id="id_input_aspect_ratio" type="hidden" value="9:16">

                            <!-- 选项卡片容器 -->
                            <div id="id_group_aspect_ratio" class="mt-3 grid grid-cols-5 gap-3">
                                <!-- 单个卡片：默认灰色；hover 与选中均为粉色高亮 -->
                                <button data-value="16:9" class="ar-item group rounded-xl bg-white/5 border border-white/10 h-24 transition hover:ring-2 hover:ring-pink-500/30 hover:border-pink-500/40">
                                    <div class="h-full w-full p-3 relative">
                                        <!-- 预留标签空间，剩余高度中居中展示比例方块 -->
                                        <div class="h-full flex items-center justify-center pb-6">
                                            <!-- 16:9 预览块 -->
                                            <div class="ar-block w-14 h-8 rounded-md bg-white/10 group-hover:bg-pink-500"></div>
                                        </div>
                                        <div class="ar-label absolute bottom-2 left-0 right-0 text-center text-gray-300 text-base group-hover:text-pink-400 group-hover:font-semibold">16:9</div>
                                    </div>
                                </button>
                                <button data-value="9:16" class="ar-item group rounded-xl bg-white/5 border border-white/10 h-24 transition hover:ring-2 hover:ring-pink-500/30 hover:border-pink-500/40">
                                    <div class="h-full w-full p-3 relative">
                                        <div class="h-full flex items-center justify-center pb-6">
                                            <!-- 9:16 预览块 -->
                                            <div class="ar-block w-7 h-11 rounded-md bg-white/10 group-hover:bg-pink-500"></div>
                                        </div>
                                        <div class="ar-label absolute bottom-2 left-0 right-0 text-center text-gray-300 text-base group-hover:text-pink-400 group-hover:font-semibold">9:16</div>
                                    </div>
                                </button>
                                <button data-value="4:3" class="ar-item group rounded-xl bg-white/5 border border-white/10 h-24 transition hover:ring-2 hover:ring-pink-500/30 hover:border-pink-500/40">
                                    <div class="h-full w-full p-3 relative">
                                        <div class="h-full flex items-center justify-center pb-6">
                                            <!-- 4:3 预览块 -->
                                            <div class="ar-block w-12 h-9 rounded-md bg-white/10 group-hover:bg-pink-500"></div>
                                        </div>
                                        <div class="ar-label absolute bottom-2 left-0 right-0 text-center text-gray-300 text-base group-hover:text-pink-400 group-hover:font-semibold">4:3</div>
                                    </div>
                                </button>
                                <button data-value="3:4" class="ar-item group rounded-xl bg-white/5 border border-white/10 h-24 transition hover:ring-2 hover:ring-pink-500/30 hover:border-pink-500/40">
                                    <div class="h-full w-full p-3 relative">
                                        <div class="h-full flex items-center justify-center pb-6">
                                            <!-- 3:4 预览块 -->
                                            <div class="ar-block w-9 h-12 rounded-md bg-white/10 group-hover:bg-pink-500"></div>
                                        </div>
                                        <div class="ar-label absolute bottom-2 left-0 right-0 text-center text-gray-300 text-base group-hover:text-pink-400 group-hover:font-semibold">3:4</div>
                                    </div>
                                </button>
                                <button data-value="1:1" class="ar-item group rounded-xl bg-white/5 border border-white/10 h-24 transition hover:ring-2 hover:ring-pink-500/30 hover:border-pink-500/40">
                                    <div class="h-full w-full p-3 relative">
                                        <div class="h-full flex items-center justify-center pb-6">
                                            <!-- 1:1 预览块 -->
                                            <div class="ar-block w-10 h-10 rounded-md bg-white/10 group-hover:bg-pink-500"></div>
                                        </div>
                                        <div class="ar-label absolute bottom-2 left-0 right-0 text-center text-gray-300 text-base group-hover:text-pink-400 group-hover:font-semibold">1:1</div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Duration -->
                        <div class="mt-4">
                            <label class="block text-sm text-gray-300 mb-2">时长</label>
                            <div class="flex items-center gap-3">
                                <div id="durationDots" class="flex items-center gap-2"></div>
                                <div class="text-sm text-gray-400"><span id="durationText">5</span>s</div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="mt-4 flex items-center gap-3">
                            <button id="btnGenerate" class="px-4 py-2 rounded bg-blue-500 hover:bg-blue-600 text-white text-sm">生成预览</button>
                        </div>
                    </section>

                    <!-- Right preview card -->
                    <section class="bg-[#0b0e13] border border-white/5 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-2">由 Seedance 1.0 Pro 驱动</div>
                        <div class="relative aspect-video bg-[#0f131a] rounded-lg overflow-hidden border border-white/10">
                            <img id="previewImg" src="./img/index_woman_2_after.jpg" alt="preview" class="w-full h-full object-cover hidden" />
                            <video id="previewVideo" class="w-full h-full object-cover" autoplay loop muted playsinline>
                                <source src="https://www.muse-steamer.com/caseVideos/e75beee00148cbf0a28c0cfcf2fdc199_1920_1080.mp4" type="video/mp4">
                            </video>
                            <div id="loader" class="absolute inset-0 bg-black/40 backdrop-blur hidden items-center justify-center">
                                <div class="w-10 h-10 border-2 border-white/20 border-t-blue-500 rounded-full animate-spin"></div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="text-sm text-gray-300 mb-1">提示词</div>
                            <div id="promptEcho" class="text-xs text-gray-400 bg-white/5 border border-white/10 rounded p-3 leading-6">
                                The ice blue Porsche speeds out from the night's high-rise...
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <style>
        .custom-scroll::-webkit-scrollbar{width:10px}
        .custom-scroll::-webkit-scrollbar-thumb{background:rgba(255,255,255,.06);border-radius:8px}
        .custom-scroll::-webkit-scrollbar-track{background:transparent}
        /* Sidebar unified styles */
        .sb-item{display:flex;align-items:center;gap:.5rem;width:100%;padding:.5rem .75rem;border-radius:.5rem;color:#cbd5e1}
        .sb-item:hover{background:rgba(255,255,255,.05);color:#e5e7eb}
        .sb-item .sb-text{font-size:.92rem}
        .sb-ico{width:18px;height:18px;color:#9aa4b2}
        .sb-active{background:#18202b;color:#fff;outline:1px solid rgba(59,130,246,.35)}
        .sb-active .sb-ico{color:#9ec1ff}
 
         /* Dropdown menu (通用弹窗) */
         .dd-menu{position:fixed;z-index:60;background:#1a1d26;border-radius:14px;border:1px solid rgba(255,255,255,.06);box-shadow:0 20px 40px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.03);min-width:220px;padding:10px}
         .dd-menu .dd-item{display:flex;align-items:center;border-radius:10px;color:#e5e7eb;font-size:16px;line-height:22px;padding:10px 14px;cursor:pointer}
         .dd-menu .dd-item:hover{background:rgba(255,255,255,.06)}
         .dd-menu .dd-item.dd-active{background:rgba(255,255,255,.08);color:#ff3d75}
         .dd-menu .dd-sep{height:1px;background:rgba(255,255,255,.06);margin:6px 4px}

        /* Select style dropdown (跟随触发宽度) */
        .sd-menu{position:fixed;z-index:60;background:linear-gradient(180deg,#2a2a2f 0%,#232325 100%);border:1px solid rgba(255,255,255,.08);border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.03);padding:8px;opacity:0;transform:translateY(-6px) scale(.98);transition:opacity .16s ease, transform .18s ease}
        .sd-menu.show{opacity:1;transform:translateY(0) scale(1)}
        .sd-menu .sd-item{display:flex;align-items:center;gap:10px;border-radius:10px;color:#e6e6e8;font-size:16px;line-height:22px;padding:10px 12px;cursor:pointer;height:42px;margin:4px 0}
        .sd-menu .sd-item:hover{background:rgba(255,255,255,.07)}
        .sd-menu .sd-item .sd-meta{display:none}
        .sd-menu .sd-item .dot{width:10px;height:10px;border-radius:9999px}
        .sd-menu .sd-item.sd-active{background:rgba(255,255,255,.1)}
        .sd-menu .sd-check{margin-left:auto;color:#e6e6e8}
    </style>

    <script>
        console.log('开始执行js代码 ....');

        // 全局错误日志（中文）
        window.addEventListener('error', function (e) {
            try { console.error('【全局错误】', e.message, ' at ', e.filename + ':' + e.lineno + ':' + e.colno); } catch(_) {}
        });
        window.addEventListener('unhandledrejection', function (e) {
            try { console.error('【Promise未处理异常】', e.reason); } catch(_) {}
        });

        // Input method
        const imUpload = document.getElementById('im-upload');
        const uploadCard = document.getElementById('uploadCard');
        

        // Upload
        const chooseFile = document.getElementById('chooseFile');
        const fileInput = document.getElementById('fileInput');
        const previewImg = document.getElementById('previewImg');
        const previewVideo = document.getElementById('previewVideo');
        chooseFile.addEventListener('click',()=>fileInput.click());
        uploadCard.addEventListener('dragover',e=>{e.preventDefault();uploadCard.classList.add('ring-2','ring-blue-500/40')});
        uploadCard.addEventListener('dragleave',()=>uploadCard.classList.remove('ring-2','ring-blue-500/40'));
        uploadCard.addEventListener('drop',e=>{e.preventDefault();uploadCard.classList.remove('ring-2','ring-blue-500/40'); if(e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);});
        fileInput.addEventListener('change',e=>{if(e.target.files[0]) handleFile(e.target.files[0]);});
        function handleFile(file){
            const url = URL.createObjectURL(file);
            previewVideo.classList.add('hidden');
            previewImg.classList.remove('hidden');
            previewImg.src = url;
        }

        // Link input
        const imgUrl = document.getElementById('imgUrl');
        imgUrl && imgUrl.addEventListener('change',()=>{
            if(!imgUrl.value) return;
            previewVideo.classList.add('hidden');
            previewImg.classList.remove('hidden');
            previewImg.src = imgUrl.value;
        });

        // Duration dots (5s, 10s, 15s, 30s)
        const durationDots = document.getElementById('durationDots');
        const durationText = document.getElementById('durationText');
        const DURS = [5,10,15,30];
        let currentDur = 5;
        DURS.forEach(d=>{
            const b = document.createElement('button');
            b.className = 'w-2.5 h-2.5 rounded-full bg-white/10 hover:bg-white/20';
            b.title = d+'s';
            b.addEventListener('click',()=>{currentDur=d;durationText.textContent=d;refreshDots();});
            durationDots.appendChild(b);
        });
        function refreshDots(){
            [...durationDots.children].forEach((el,i)=>{
                const active = DURS[i]===currentDur;
                el.className = 'w-2.5 h-2.5 rounded-full ' + (active? 'bg-blue-500' : 'bg-white/10 hover:bg-white/20');
            });
        }
        refreshDots();

        // 生成视频
        const btnGenerate = document.getElementById('btnGenerate');
        const loader = document.getElementById('loader');
        const prompt = document.getElementById('prompt');
        const promptEcho = document.getElementById('promptEcho');
        btnGenerate.addEventListener('click',async()=>{
            loader.classList.remove('hidden');
            promptEcho.textContent = (prompt.value||'').trim() || 'The ice blue Porsche speeds out from the night\'s high-rise...';
            await new Promise(r=>setTimeout(r,800));
            // show demo video if no image chosen
            if(previewImg.classList.contains('hidden')){
                previewVideo.classList.remove('hidden');
            }
            loader.classList.add('hidden');
        });

        // Theme toggle (light/dark minimal)
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click',()=>{
            document.body.classList.toggle('bg-white');
        });

        // ------------------------------
        // 侧边栏
        // 想要让谁显示选中状态，就给谁设置为 sb-active
        // ------------------------------
        function initSidebarSelection(){
            console.log('【侧边栏初始化】开始绑定侧边栏点击事件');
            var sidebar = document.querySelector('aside');
            if(!sidebar) return;
            var items = Array.prototype.slice.call(sidebar.querySelectorAll('.sb-item'));
            console.log('【侧边栏初始化】找到条目数量 =', items.length);
            if(items.length === 0) return;
            var hasActive = false;
            for (var i=0;i<items.length;i++){ if(items[i].classList.contains('sb-active')) { hasActive = true; break; } }
            if(!hasActive){ items[0].classList.add('sb-active'); }
            function selectItem(target){
                for (var j=0;j<items.length;j++){ items[j].classList.remove('sb-active'); }
                target.classList.add('sb-active');
                console.log('【侧边栏选中】当前选中 =', target.textContent.trim());
            }
            for (var k=0;k<items.length;k++){
                var el = items[k];
                el.setAttribute('role','button');
                el.setAttribute('tabindex','0');
                el.addEventListener('click', (function(t){ return function(){ console.log('【侧边栏点击】', t.textContent.trim()); selectItem(t); }; })(el));
                el.addEventListener('keydown', (function(t){ return function(e){ if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); selectItem(t); } }; })(el));
            }
            console.log('【侧边栏初始化】完成');
        }

        // ---------------------------------------
        // Dropdown (通用弹窗) 组件：anchor + items
        // ---------------------------------------
        function Dropdown(){
            this.menu = null;
            this.anchor = null;
            this._boundOutside = null;
            this._boundResize = null;
        }
        Dropdown.prototype.show = function(anchor, items, activeIndex, onSelect){
            if(typeof activeIndex === 'undefined'){ activeIndex = -1; }
            if(typeof onSelect !== 'function'){ onSelect = function(){}; }
            // 若已展开且为同一触发器，则切换为关闭
            if(this.menu && this.anchor === anchor){ this.hide(); return; }
            this.hide();
            // 构建容器
            const menu = document.createElement('div');
            menu.className = 'dd-menu';
            // 填充条目
            for (var i=0;i<items.length;i++){
                var label = items[i];
                if(label === '---'){ // 分割线支持
                    const sep = document.createElement('div');
                    sep.className = 'dd-sep';
                    menu.appendChild(sep);
                    continue;
                }
                const it = document.createElement('div');
                it.className = 'dd-item' + (i===activeIndex ? ' dd-active' : '');
                it.textContent = label;
                it.addEventListener('click', (function(self, index, lbl){ return function(){ console.log('【顶栏下拉选择】', lbl); onSelect(index, lbl); self.hide(); }; })(this, i, label));
                menu.appendChild(it);
            }
            document.body.appendChild(menu);
            this.menu = menu;
            this.anchor = anchor;
            // 定位：按钮下方 8px，左对齐
            const rect = anchor.getBoundingClientRect();
            const top = Math.round(rect.bottom + 8);
            const left = Math.round(rect.left);
            menu.style.top = top + 'px';
            menu.style.left = left + 'px';
            // 监听关闭
            setTimeout(function(){
                this._boundOutside = this.onOutside.bind(this);
                this._boundResize = this.onResize.bind(this);
                document.addEventListener('click', this._boundOutside);
                window.addEventListener('resize', this._boundResize);
                window.addEventListener('scroll', this._boundResize, true);
                console.log('【顶栏下拉】已显示，位置 top/left =', top, left);
            }.bind(this), 0);
        };
        Dropdown.prototype.onOutside = function(e){ if(this.menu && !this.menu.contains(e.target)){ this.hide(); } };
        Dropdown.prototype.onResize = function(){ this.hide(); };
        Dropdown.prototype.hide = function(){
            if(this.menu){
                this.menu.remove();
                this.menu = null;
                this.anchor = null;
                if(this._boundOutside){ document.removeEventListener('click', this._boundOutside); this._boundOutside=null; }
                if(this._boundResize){ window.removeEventListener('resize', this._boundResize); window.removeEventListener('scroll', this._boundResize, true); this._boundResize=null; }
                console.log('【顶栏下拉】已关闭');
            }
        };

        // 绑定到顶栏 5 个按钮
        function bindTopNavDropdowns(){
            console.log('【顶栏初始化】开始绑定顶栏点击事件');
            var dd = new Dropdown();
            var commonItems = ['All','Videos','AI Video Effects','Images'];
            function attach(btnId){
                var btn = document.getElementById(btnId);
                if(!btn) return;
                btn.addEventListener('click', function(e){
                    e.stopPropagation();
                    console.log('【顶栏点击】按钮ID =', btnId);
                    dd.show(btn, commonItems, 2, function(i, label){
                        // 回调可扩展
                    });
                });
            }
            attach('id_btn_nav_video');
            attach('id_btn_nav_effects');
            attach('id_btn_nav_image');
            attach('id_btn_nav_gallery');
            attach('id_btn_nav_pricing');
            console.log('【顶栏初始化】完成');
        }

        // ---------------------------------------
        // Select-like Dropdown (通用选择器) 组件
        // ---------------------------------------
        function SelectDropdown(){
            this.menu = null;
            this.anchor = null;
            this._boundOutside = null;
            this._boundResize = null;
        }
        SelectDropdown.prototype.show = function(anchor, items, activeIndex, onSelect){
            if(typeof activeIndex === 'undefined'){ activeIndex = 0; }
            if(typeof onSelect !== 'function'){ onSelect = function(){}; }
            // 若已展开且为同一触发器，则关闭
            if(this.menu && this.anchor === anchor){ this.hide(); return; }
            this.hide();
            const menu = document.createElement('div');
            menu.className = 'sd-menu';
            // 跟随父容器宽度：找到最近的定位容器或父块元素
            const rect = anchor.getBoundingClientRect();
            const parent = anchor.parentElement || anchor;
            const pRect = parent.getBoundingClientRect();
            menu.style.minWidth = Math.round(pRect.width) + 'px';
            // 构建条目（支持主标题+说明+颜色点+对勾）
            for (var i=0;i<items.length;i++){
                var it = items[i];
                const row = document.createElement('div');
                row.className = 'sd-item' + (i===activeIndex ? ' sd-active' : '');
                const dot = document.createElement('span');
                dot.className = 'dot';
                dot.style.background = it.dot || '#7c3aed';
                const textWrap = document.createElement('div');
                const title = document.createElement('div');
                title.textContent = it.title;
                const meta = document.createElement('div');
                meta.className = 'sd-meta';
                meta.textContent = it.meta || '';
                textWrap.appendChild(title);
                if(it.meta){ textWrap.appendChild(meta); }
                row.appendChild(dot);
                row.appendChild(textWrap);
                if(i===activeIndex){
                    const check = document.createElement('div');
                    check.className = 'sd-check';
                    check.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>';
                    row.appendChild(check);
                }
                row.addEventListener('click', (function(self, index, item){ return function(){ console.log('【选择器选择】', item.title); onSelect(index, item); self.hide(); }; })(this, i, it));
                menu.appendChild(row);
            }
            document.body.appendChild(menu);
            this.menu = menu;
            this.anchor = anchor;
            // 定位：下方 6px 左对齐
            const top2 = Math.round(rect.bottom + 6);
            const left2 = Math.round(pRect.left);
            menu.style.top = top2 + 'px';
            menu.style.left = left2 + 'px';
            // 关闭监听
            setTimeout(function(){
                menu.classList.add('show');
                this._boundOutside = this.onOutside.bind(this);
                this._boundResize = this.onResize.bind(this);
                document.addEventListener('click', this._boundOutside);
                window.addEventListener('resize', this._boundResize);
                window.addEventListener('scroll', this._boundResize, true);
                console.log('【选择器】已显示，位置 top/left =', top2, left2, ' 宽度 =', Math.round(pRect.width));
            }.bind(this),0);
        };
        SelectDropdown.prototype.onOutside = function(e){ if(this.menu && !this.menu.contains(e.target)){ this.hide(); } };
        SelectDropdown.prototype.onResize = function(){ this.hide(); };
        SelectDropdown.prototype.hide = function(){
            if(this.menu){
                this.menu.remove();
                this.menu = null;
                this.anchor = null;
                if(this._boundOutside){ document.removeEventListener('click', this._boundOutside); this._boundOutside=null; }
                if(this._boundResize){ window.removeEventListener('resize', this._boundResize); window.removeEventListener('scroll', this._boundResize, true); this._boundResize=null; }
                console.log('【选择器】已关闭');
            }
        };

        // 绑定分辨率选择
        function bindResolutionSelect(){
            var btn = document.getElementById('id_btn_resolution');
            var text = document.getElementById('id_text_resolution');
            var nativeSel = document.getElementById('id_select_resolution');
            if(!btn || !text || !nativeSel) return;
            var sd = new SelectDropdown();
            var items = [
                { title:'480p', meta:'Basic Quality • 1 credit', dot:'#a78bfa' },
                { title:'720p', meta:'High Quality • 2 credits', dot:'#60a5fa' },
                { title:'1080p', meta:'Ultra Quality • 3 credits', dot:'#f59e0b' }
            ];
            function activeIndex(){
                var val = nativeSel.value;
                for (var i=0;i<items.length;i++){ if(items[i].title===val) return i; }
                return 0;
            }
            btn.addEventListener('click', function(e){
                e.stopPropagation();
                console.log('【分辨率点击】当前值 =', nativeSel.value);
                sd.show(btn, items, activeIndex(), function(i, it){
                    nativeSel.value = it.title;
                    text.textContent = it.title;
                    console.log('【分辨率变更】新值 =', it.title);
                });
            });
            console.log('【分辨率初始化】完成，默认值 =', nativeSel.value);
        }

        // 绑定宽高比选择
        function bindAspectRatioSelect(){
            // 容器、隐藏域
            var group = document.getElementById('id_group_aspect_ratio');
            var input = document.getElementById('id_input_aspect_ratio');
            if(!group || !input){ console.warn('【宽高比初始化】未找到控件'); return; }
            var items = group.querySelectorAll('.ar-item');

            // 切换选中样式的函数
            function setActive(target){
                for(var i=0;i<items.length;i++){
                    items[i].classList.remove('ar-active','ring-2','ring-pink-500/30','border-pink-500/40');
                    // 将文字与占位颜色恢复（默认灰色）
                    var label = items[i].querySelector('.ar-label');
                    var block = items[i].querySelector('.ar-block');
                    if(label){ label.classList.remove('text-pink-400','font-semibold'); label.classList.add('text-gray-300'); }
                    if(block){ block.classList.remove('bg-pink-500'); block.classList.add('bg-white/10'); }
                }
                target.classList.add('ar-active','ring-2','ring-pink-500/30','border-pink-500/40');
                var label2 = target.querySelector('.ar-label');
                var block2 = target.querySelector('.ar-block');
                if(label2){ label2.classList.remove('text-gray-300'); label2.classList.add('text-pink-400','font-semibold'); }
                if(block2){ block2.classList.remove('bg-white/10'); block2.classList.add('bg-pink-500'); }
            }

            // 绑定点击事件
            for(var j=0;j<items.length;j++){
                (function(el){
                    el.addEventListener('click', function(){
                        var val = el.getAttribute('data-value');
                        input.value = val; // 写入隐藏域
                        setActive(el);    // 切换高亮
                        console.log('【宽高比变更】新值 =', val);
                    });
                })(items[j]);
            }

            // 根据隐藏域初始值设置一次选中
            var init = input.value || '9:16';
            for(var k=0;k<items.length;k++){
                if(items[k].getAttribute('data-value') === init){ setActive(items[k]); break; }
            }
            console.log('【宽高比初始化】完成，默认 =', input.value);
        }

        // 绑定模型选择（仿照分辨率下拉）
        function bindModelSelect(){
            var btn = document.getElementById('id_btn_model');
            var text = document.getElementById('id_text_model');
            var nativeSel = document.getElementById('id_select_model');
            if(!btn || !text || !nativeSel){ console.warn('【模型初始化】未找到模型相关控件'); return; }
            var sd = new SelectDropdown();
            var items = [
                { title:'Google VEO3',  meta:'高质量 • 稳定表现', dot:'#a78bfa' },
                { title:'RunWay Gen-4', meta:'高质量 • 创意镜头', dot:'#60a5fa' },
                { title:'Midjourney',   meta:'风格化 • 表现力强', dot:'#f59e0b' }
            ];
            function activeIndex(){
                var val = nativeSel.value;
                for (var i=0;i<items.length;i++){ if(items[i].title===val) return i; }
                // 由于 select 的 value 与 title 不一致（示例值为480p/720p/1080p），这里用显示文本兜底
                var fallback = text ? text.textContent : '';
                for (var j=0;j<items.length;j++){ if(items[j].title===fallback) return j; }
                return 0;
            }
            btn.addEventListener('click', function(e){
                e.stopPropagation();
                console.log('【模型点击】当前 =', text ? text.textContent : '');
                sd.show(btn, items, activeIndex(), function(i, it){
                    // 同步显示文本
                    if(text) text.textContent = it.title;
                    // 同步原生 select（为了表单/可访问性），将 option 的选中更新到与 title 同名项
                    try{
                        var matched = null;
                        for (var k=0;k<nativeSel.options.length;k++){
                            if(nativeSel.options[k].text === it.title){ matched = nativeSel.options[k]; break; }
                        }
                        if(matched){ nativeSel.value = matched.value; }
                    }catch(err){ console.warn('【模型选择】同步原生select失败：', err); }
                    console.log('【模型变更】新值 =', it.title);
                });
            });
            console.log('【模型初始化】完成，默认 =', text ? text.textContent : '');
        }

        // -------- 页面初始化入口（含兜底）--------
        function init_all_components(){
            try { console.log('【DOM就绪】开始初始化组件'); } catch(_) {}
            try { initSidebarSelection && initSidebarSelection(); } catch(err){ console.error('【初始化错误】侧边栏初始化失败：', err); }
            try { bindTopNavDropdowns && bindTopNavDropdowns(); } catch(err){ console.error('【初始化错误】顶栏初始化失败：', err); }
            try { bindResolutionSelect && bindResolutionSelect(); } catch(err){ console.error('【初始化错误】分辨率初始化失败：', err); }
            try { bindAspectRatioSelect && bindAspectRatioSelect(); } catch(err){ console.error('【初始化错误】宽高比初始化失败：', err); }
            try { bindModelSelect && bindModelSelect(); } catch(err){ console.error('【初始化错误】模型初始化失败：', err); }
            try { bindSidebarRoute && bindSidebarRoute(); } catch(err){ console.error('【初始化错误】侧栏路由失败：', err); }
            try { console.log('【DOM就绪】初始化结束'); } catch(_) {}
        }

        // 优先使用 DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function(){
            init_all_components();
        });

        // 侧栏路由绑定：Text to Video / Image to Video 按钮跳转
        function bindSidebarRoute(){
            var items = document.querySelectorAll('.sb-item');
            if(!items || items.length===0){ console.warn('【侧栏路由】未找到 sb-item'); return; }
            for(var i=0;i<items.length;i++){
                (function(el){
                    var labelEl = el.querySelector('.sb-text');
                    var text = labelEl ? labelEl.textContent.trim().toLowerCase() : '';
                    var target = '';
                    if(text.indexOf('text to video')>-1){ target = '../text-to-video/index.html'; }
                    if(text.indexOf('image to video')>-1){ target = '../image-to-video/index.html'; }
                    if(target){
                        el.addEventListener('click', function(){
                            console.log('【侧栏路由】跳转到: ', target);
                            window.location.href = target;
                        });
                    }
                })(items[i]);
            }
            console.log('【侧栏路由】已绑定');
        }
    </script>

</body>
</html>
